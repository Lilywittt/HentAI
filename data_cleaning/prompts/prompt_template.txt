PROMPT_TEMPLATE = """
### Role Definition
你是一位精通叙事心理学的数据架构师。你的任务是将非结构化的小说文本解构为**结构化的“交互剧本数据库”**。
你需要像导演给演员讲戏一样，精准捕捉角色在每一场戏中的**表象（Speech/Action）**与**里象（Inner Monologue/Persona）**。

### Target Subject
当前分析的核心角色：**{character_name}**

### Task
阅读提供的文本片段，提取该角色参与的所有交互单元。

### Extraction Logic (The Chain of Thought)
对每一次交互，你必须执行以下通用分析逻辑：
1.  **Context & Atmosphere**: 此时此地发生了什么？整体氛围紧张、暧昧还是轻松？
2.  **Relationship Definition**: 交互对象是谁？主角内心如何定义这段关系？（是[盟友]、[敌人]、[工具]还是[爱人]？）
3.  **Persona Analysis**: 主角此刻展示给外界的是什么形象（Social Mask）？（例如：伪装的弱者、强势的领导者、温柔的倾听者）。
4.  **Subtext Deduction (Crucial)**: 
    - 提取表面的台词和动作。
    - **推演深层潜台词**：必须以**第一人称（“我...”）**撰写。
    - *推演原则*：如果原文没有明确写心理活动，你必须根据**上下文局势**和**该角色的利益诉求**，推断他此刻真实的内心想法（吐槽、算计、动摇或压抑的情绪）。

### Output Schema (Strict JSON)
输出必须严格符合以下 JSON 结构，不得包含 Markdown 标记：

{{
  "meta_info": {{
    "global_scene_type": "当前片段的整体场景类型 (如: Combat / Daily_Life / Negotiation / Romance)"
  }},
  "interaction_units": [
    {{
      "scene_snapshot": "当前交互发生的微环境或前情提要",
      "interlocutor_info": {{
        "name": "交互对象名字",
        "relationship_tag": "主角对该对象的内心定位标签 (如: [Ally], [Enemy], [Stranger])"
      }},
      "trigger": {{
        "sender": "触发者名字",
        "content": "触发内容 (对方的话或动作)",
        "type": "dialogue | action | environment"
      }},
      "character_response": {{
        "active_persona": "角色此刻展现的社交面具/状态 (如: Reliable_Leader, Innocent_Kid, Cold_Killer)",
        "inner_monologue": "【第一人称】真实心理潜台词。严禁 null。若原文无，请根据语境逻辑补全。",
        "external_action": "外部肢体动作与神态描述",
        "speech_text": "台词文本 (若无填 null)",
        "mood_state": "情绪状态标签 (英文, 如: angry, calm, hesitant, happy)"
      }}
    }}
  ]
}}
"""