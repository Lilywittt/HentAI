**数据转换器 (Data Converter)** 开发需求：

### 1. 功能目标
编写一个 Python 脚本，将**中间态树状 JSON 文件**批量转换为 **LoRA 训练用的 Alpaca 格式 JSONL 文件**。

### 2. 输入输出定义
*   **输入源**：封装一个可以指定读取文件或文件夹路径的接口。用项目目录下的example1.txt,example2.txt测试。
*   **输出目标**：单个 `.jsonl` 文件。每一行是一个完整的 JSON 对象：`{"instruction": "...", "input": "...", "output": "..."}`。在项目目录下新建一个总文件夹，并对每个输出打上时间标签。

### 3. 字段映射与组装逻辑 (核心需求)

你需要实现以下三个字段的字符串拼接逻辑：

#### A. 构造 `instruction` (上下文注入)
将元数据拼装为 System Prompt，建立“条件反射”锚点。
*   **拼接公式**：
    ```text
    你现在是{TARGET_CHARACTER}。
    当前场景：{scene_snapshot} (类型：{global_scene_type})。
    当前状态：[{active_persona}]。
    对话对象：{interlocutor_name} (关系：[{relationship_tag}])。
    请基于人设和当前局势进行回应。
    ```
*   **空值处理**：若某字段缺失，填入默认值（如 `Default`, `Unknown`）。

#### B. 构造 `input` (触发源)
*   **拼接公式**：
    ```text
    {trigger.content}
    ```
    *(可选优化：如果需要强调是谁说的，可改为 `{trigger.sender}：{trigger.content}`)*

#### C. 构造 `output` (响应闭环)
必须严格遵守 **思维 -> 行为 -> 语言 -> 状态** 的顺序，并使用特殊标签包裹。
*   **拼接公式**：
    ```text
    <think>{inner_monologue}</think> *{external_action}* {speech_text} <mood:{mood_state}>
    ```
*   **清洗规则**：
    1.  **`inner_monologue`**：去除换行符 `\n`，若为空，则**丢弃该条数据**（视为无效样本）。
    2.  **`external_action`**：若为 `null`，不生成 `*...*` 部分。
    3.  **`speech_text`**：若为 `null`，仅保留思维和动作。
    4.  **`mood_state`**：若包含中文（如"愤怒"），需建立映射表转为英文（如"angry"）。

### 4. 异常处理要求
*   **无效数据过滤**：如果一条数据里 `input` 为空，或者 `inner_monologue` 为空，直接跳过，不写入 JSONL。
*   **格式清洗**：确保生成的 JSONL 不含非法的控制字符，确保一行一条 JSON。

---

**一句话总结给开发：**
写个脚本遍历 JSON，提取字段按上述 3 个公式拼字符串，过滤掉没心理活动的废数据，存成 jsonl。