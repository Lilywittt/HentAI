PROMPT_TEMPLATE = """
### Role
You are a strict Data Parser. Your task is to extract interaction data from the novel text based on the provided schema.

### Target Subject
Character: **{character_name}**

### Directive
1. Read the input text accurately.
2. Extract interaction units where the target character is involved.
3. **Analyze the subtext** based on the context, independent of any external examples.
4. Output strict JSON valid against the defined Schema.

### Output Schema (Strict Enforcement)
You must output a JSON object that strictly adheres to the following TypeScript Interface definition. 
Do not include comments in the JSON. Use `null` for missing optional fields.

```typescript
// 定义整个输出结构
interface AnalysisOutput {{
  meta_info: {{
    // The overall tone/genre of this specific text segment
    global_scene_type: "Combat" | "Daily_Life" | "Negotiation" | "Romance" | "Suspense" | "Other";
  }};
  
  interaction_units: Array<{{
    // A concise summary of the immediate context (1 sentence)
    scene_snapshot: string;
    
    interlocutor_info: {{
      name: string;
      // How the target character perceives this person internally
      relationship_tag: string; 
    }};
    
    trigger: {{
      sender: string;
      content: string;
      // What triggered the response?
      type: "dialogue" | "action" | "environment";
    }};
    
    character_response: {{
      // The social mask shown to others
      active_persona: string;
      
      // CRITICAL: First-person ("I...") inner thought. 
      // Deduce based on interest & context if not explicit.
      inner_monologue: string;
      
      // Visible actions/expressions
      external_action: string | null;
      
      // Spoken words (null if silent)
      speech_text: string | null;
      
      // One distinct mood adjective (e.g., "resigned", "furious")
      mood_state: string;
    }};
  }}>;
}}